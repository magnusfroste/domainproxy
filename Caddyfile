{
  email magnus@froste.eu
  admin 0.0.0.0:2019
  
  # On-demand TLS: Caddy will provision certs for any hostname on first request
  # The ask endpoint validates if the hostname should get a cert
  on_demand_tls {
    ask http://proxy:3000/api/v1/verify-domain
  }
}

# Localhost HTTP access (port 80)
http://localhost {
  reverse_proxy subdomain:3000
}

# Local wildcard HTTP (*.lvh.me â†’ Subdomain) - no TLS for local testing
http://*.lvh.me {
  reverse_proxy subdomain:3000
}

# HTTPS localhost (port 443) - with self-signed cert
https://localhost {
  tls internal
  reverse_proxy subdomain:3000
}

https://*.lvh.me {
  tls internal
  reverse_proxy subdomain:3000
}

# Prod edge: SaaS proxy on new VPS (HTTPS + HTTP)
subdomains.site, www.subdomains.site {
  reverse_proxy proxy:3000 {
    header_up Host {host}
  }
}

# Catch-all for any customer domain with on-demand TLS
# Caddy provisions certs automatically when a request comes in
# and the /api/v1/verify-domain endpoint confirms the domain is registered
https:// {
  tls {
    on_demand
  }
  reverse_proxy proxy:3000 {
    header_up Host {host}
  }
}

# HTTP catch-all (redirects to HTTPS or serves ACME challenges)
http:// {
  reverse_proxy proxy:3000 {
    header_up Host {host}
  }
}